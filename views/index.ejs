<!-- include header -->
<%- include('include/_header') %>
<!-- /include header -->

<!-- Main Site -->
<main>
  <div class="flex justify-between items-center p-4">
    <div class="flex items-center gap-4">
      <img
        src="img/SE-GitHub-image.png"
        alt="Huskie Code Logo"
        class="w-[100px] h-[100px]"
      />
      <h1 class="text-2xl font-bold">FLL Competition Scheduler</h1>
    </div>
    <a
      href="/auth/logout"
      onclick="signOut()"
      class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
    >
      Logout
    </a>
  </div>

  <!-- Add these styles and script -->
  <script src="https://apis.google.com/js/platform.js"></script>
  <script>
    function signOut() {
      // First destroy the session
      fetch("/auth/logout")
        .then(() => {
          // Then sign out of Google
          const auth2 = gapi.auth2.getAuthInstance();
          if (auth2) {
            auth2.signOut();
          }
          // Finally redirect
          window.location.href = "/auth";
        })
        .catch(() => {
          // If there's an error, redirect anyway
          window.location.href = "/auth";
        });
    }
  </script>

  <!-- Table Runs Schedule -->
  <div class="p-4">
    <h2 class="text-2xl font-bold mb-6">Robot Game Schedule</h2>
    <% if (schedule && schedule.tableRuns) { %>
    <div class="space-y-8">
      <% schedule.tableRuns.forEach((table, tableIndex) => { %>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <h3 class="bg-gray-100 px-6 py-3 text-lg font-semibold">
          Table <%= tableIndex + 1 %>
        </h3>
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Time
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Team
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Duration
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% table.sort((a, b) => a.startTime - b.startTime).forEach(event =>
            { %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= Math.floor(event.startTime/60) %>:<%=
                String(event.startTime%60).padStart(2, '0') %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.teamName %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.duration %> min
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% }); %>
    </div>
    <% } %>
  </div>

  <!-- Judging Schedule -->
  <div class="p-4">
    <h2 class="text-2xl font-bold mb-6">Judging Schedule</h2>
    <% if (schedule && schedule.judgingSchedule) { %>
    <div class="space-y-8">
      <% schedule.judgingSchedule.forEach((room, roomIndex) => { %>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <h3 class="bg-gray-100 px-6 py-3 text-lg font-semibold">
          Judging Room <%= roomIndex + 1 %>
        </h3>
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Time
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Team
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Type
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Duration
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% room.sort((a, b) => a.startTime - b.startTime).forEach(event => {
            %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= Math.floor(event.startTime/60) %>:<%=
                String(event.startTime%60).padStart(2, '0') %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.teamName %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.type === 'robotJudging' ? 'Robot Design' : 'Project'
                %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.duration %> min
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% }); %>
    </div>
    <% } %>
  </div>

  <!-- Team Schedule -->
  <div class="p-4">
    <h2 class="text-2xl font-bold mb-6">Team Schedules</h2>
    <% if (schedule && schedule.teamsSchedule) { %>
    <div class="space-y-8">
      <% schedule.teamsSchedule.forEach((team, teamIndex) => { %> <% if
      (team.length > 0) { %>
      <div class="bg-white rounded-lg shadow overflow-hidden">
        <h3 class="bg-gray-100 px-6 py-3 text-lg font-semibold">
          Team <%= teamIndex %>
        </h3>
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Time
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Event
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Location
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Duration
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% team.sort((a, b) => a.startTime - b.startTime).forEach(event => {
            %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= Math.floor(event.startTime/60) %>:<%=
                String(event.startTime%60).padStart(2, '0') %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <% if (event.type === 'tableRun') { %> Robot Game <% } else if
                (event.type === 'robotJudging') { %> Robot Design Judging <% }
                else { %> Project Judging <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.locationName %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <%= event.duration %> min
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
      <% } %> <% }); %>
    </div>
    <% } %>
  </div>
</main>

<!-- include footer -->
<%- include('include/_footer') %>
<!-- /include footer -->
